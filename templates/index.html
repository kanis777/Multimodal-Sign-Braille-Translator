<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech or Image to Sign Language or Braille</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
           font-family: 'Lato', sans-serif;
           text-align: center;
           margin: 0;
           padding: 0;
           background-image: url('https://tse2.mm.bing.net/th?id=OIP.nZIWxooXDFrvYxG9-AyacQHaFm&pid=Api&P=0&h=180'); /* Change to your image */
           background-size: cover;
           background-position: center;
           background-attachment: fixed;
           color: white;
       }



       .container {
           background-color: rgba(0, 0, 0, 0.7); /* semi-transparent for readability */
           padding: 30px;
           border-radius: 15px;
           margin-top: 30px;
       }

       .hidden { display: none; }

       #sign-images img {
           margin: 5px;
           max-height: 150px;
       }

       #braille-output {
           font-size: 24px;
           margin-top: 10px;
           color: #f8f9fa;
       }

       .btn-custom {
           background-color: #17a2b8;
           border: none;
           color: white;
       }

       .btn-custom:hover {
           background-color: #138496;
       }

       .btn-custom-secondary {
           background-color: #ffc107;
           border: none;
           color: black;
       }

       .btn-custom-secondary:hover {
           background-color: #e0a800;
       }
       /* New Hover Transition */
       .btn-custom, .btn-custom-secondary {
            transition: background-color 0.3s ease;  /* Smooth transition on hover */
       }

        /* Active State for Buttons */
       .btn-custom:active, .btn-custom-secondary:active {
            background-color: #005f73;  /* Darker shade when the button is pressed */
       }

       h1, h3 {
           color: #f8f9fa;
       }

       textarea,
       input[type="file"],
       select {
           background-color: #f8f9fa;
      }

    </style>
</head>
<body>
    <div class="container">
        <h1 class="my-4">Speech or Image to Sign Language or Braille</h1>

        <div id="options">
            <h3>Choose an option:</h3>
            <button class="btn btn-custom m-2" onclick="chooseMethod('live')">Live Transcription</button>
            <button class="btn btn-custom m-2" onclick="chooseMethod('upload')">Upload Audio File</button>
            <button class="btn btn-custom m-2" onclick="chooseMethod('image')">Upload Image</button>
            <button class="btn btn-custom m-2" onclick="chooseMethod('text')">Text</button>
        </div>

        <div id="method-selection" class="hidden mt-3">
            <h3>Select Transcription Method:</h3>
            <select id="transcriptionMethod" class="form-select w-50 mx-auto">
                <option value="whisper">Whisper</option>
                <option value="google">Google Speech</option>
            </select>
            <button class="btn btn-custom mt-2" onclick="startTranscription()">Transcribe</button>
        </div>
        <!-- Loading Spinner -->
        <div id="loading" class="hidden" style="text-align: center;">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>

        <div id="file-upload" class="hidden mt-3">
            <input type="file" id="audioFile" class="form-control w-50 mx-auto">
        </div>

        <div id="image-upload" class="hidden mt-3">
            <input type="file" id="imageFile" class="form-control w-50 mx-auto">
            <button class="btn btn-custom mt-2" onclick="uploadImage()">Upload & Transcribe</button>
        </div>

        <div id="text-input" class="hidden mt-3">
            <textarea id="directText" class="form-control w-50 mx-auto" rows="4" placeholder="Enter text here..."></textarea>
            <button class="btn btn-custom mt-2" onclick="submitText()">Submit Text</button>
        </div>

        <div id="transcription-section" class="hidden mt-4">
            <h3>Transcription:</h3>
            <p id="transcription"></p>
            <div id="output-selection">
                <h3>Convert to:</h3>
                <button class="btn btn-custom-secondary m-1" onclick="convertOutput('sign')">Sign Language</button>
                <button class="btn btn-custom-secondary m-1" onclick="convertOutput('braille')">Braille</button>
            </div>
        </div>

        <div id="sign-language-section" class="hidden mt-4">
            <h3>Sign Language Representation:</h3>
            <div id="sign-images"></div>
        </div>

        <div id="braille-section" class="hidden mt-4">
            <h3>Braille Representation:</h3>
            <p id="braille-output"></p>
        </div>

        <div id="back-button" class="hidden">
            <button class="btn btn-custom m-2" onclick="goBack()">Back</button>
        </div>
    </div>

    <script>
        let method = "";
        let transcribedText = "";

        // Function to show and hide the "Back" button
        function showBackButton() {
            document.getElementById("back-button").classList.remove("hidden");
        }

        function hideBackButton() {
            document.getElementById("back-button").classList.add("hidden");
        }

        function chooseMethod(selectedMethod) {
            method = selectedMethod;
            document.getElementById("options").classList.add("hidden");
            document.getElementById("method-selection").classList.add("hidden");
            document.getElementById("file-upload").classList.add("hidden");
            document.getElementById("image-upload").classList.add("hidden");
            document.getElementById("text-input").classList.add("hidden");

            showBackButton();  // Show the back button

            if (method === "upload") {
                document.getElementById("file-upload").classList.remove("hidden");
                document.getElementById("method-selection").classList.remove("hidden");
            } else if (method === "image") {
                document.getElementById("image-upload").classList.remove("hidden");
            } else if (method === "text") {
                document.getElementById("text-input").classList.remove("hidden");
            } else {
                document.getElementById("method-selection").classList.remove("hidden");
            }
        }

        // Function to go back to the previous page/section
        function goBack() {
            document.getElementById("options").classList.remove("hidden");
            document.getElementById("method-selection").classList.add("hidden");
            document.getElementById("file-upload").classList.add("hidden");
            document.getElementById("image-upload").classList.add("hidden");
            document.getElementById("text-input").classList.add("hidden");
            
            hideBackButton();  // Hide the back button
        }


        function startTranscription() {
            // Show loading spinner
            document.getElementById("loading").classList.remove("hidden");
        
            let transcriptionMethod = document.getElementById("transcriptionMethod").value;
            if (method === "live") {
                fetch(`/live_transcribe?method=${transcriptionMethod}`)
                    .then(response => response.json())
                    .then(data => {
                        handleTranscription(data.transcription);
                        // Hide loading spinner after transcription is done
                        document.getElementById("loading").classList.add("hidden");
                    });
            } else if (method === "upload") {
                uploadFile(transcriptionMethod);
            }
        }        

        function uploadFile(transcriptionMethod) {
            let fileInput = document.getElementById("audioFile");
            if (fileInput.files.length === 0) {
                alert("Please select a file.");
                return;
            }
        
            let formData = new FormData();
            formData.append("file", fileInput.files[0]);
            formData.append("method", transcriptionMethod);
        
            // Show loading spinner
            document.getElementById("loading").classList.remove("hidden");
        
            fetch("/transcribe", { method: "POST", body: formData })
                .then(response => response.json())
                .then(data => {
                    handleTranscription(data.transcription);
                    // Hide loading spinner after transcription is done
                    document.getElementById("loading").classList.add("hidden");
                });
        }
        
        function uploadImage() {
            let fileInput = document.getElementById("imageFile");
            if (fileInput.files.length === 0) {
                alert("Please select an image.");
                return;
            }
            let formData = new FormData();
            formData.append("image", fileInput.files[0]);

            fetch("/upload", { method: "POST", body: formData })
                .then(response => response.json())
                .then(data => {
                    handleTranscription(data.text);
                });
        }

        async function submitText() {
            const input = document.getElementById("directText").value.trim();
            if (!input) {
                alert("Please enter some text.");
                return;
            }

            try {
                const response = await fetch("/translate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ text: input })
                });

                const result = await response.json();

                if (response.ok) {
                    const translated = result.translated;

                    document.getElementById("transcription-section").classList.remove("hidden");
                    document.getElementById("transcription").textContent = translated;

                    // Store it globally or pass it forward for Braille/Sign conversion
                    transcribedText = translated;
                } else {
                    alert(result.error || "Translation failed");
                }
            } catch (err) {
                
                console.error("Error:", err);
                alert("An error occurred while translating the text.");
            }
        }

        function handleTranscription(text) {
            if (!text) return;
            transcribedText = text;
            document.getElementById("transcription-section").classList.remove("hidden");
            document.getElementById("transcription").textContent = text;
        }

        function convertOutput(type) {
            if (type === "sign") {
                fetch(`/isl/${encodeURIComponent(transcribedText)}`)
                    .then(response => response.json())
                    .then(data => displayGIF(data.gifs));
            } else if (type === "braille") {
                fetch(`/braille/${encodeURIComponent(transcribedText)}`)
                    .then(response => response.json())
                    .then(data => displayBraille(data.braille));
            }
        }

        function displayGIF(gifBase64List) {
            document.getElementById("sign-language-section").classList.remove("hidden");
            let container = document.getElementById("sign-images");
            container.innerHTML = ""; // Clear previous content

            gifBase64List.forEach(gifBase64 => {
                let gifElement = document.createElement("img");
                gifElement.src = gifBase64; // Base64-encoded GIF string
                gifElement.style.width = "300px"; // Adjust size as needed
                gifElement.style.margin = "10px";

                container.appendChild(gifElement);
            });
        }

        function displayBraille(brailleText) {
            document.getElementById("braille-section").classList.remove("hidden");
            document.getElementById("braille-output").textContent = brailleText;
        }
    </script>
</body>
</html>
